---
feature: damage-calculator
type: requirements
version: 1.0.0
created: 2025-01-28
status: draft
---

# 傷害計算器 - 需求文件

## 功能概述

**傷害計算器**是一個互動式工具，協助 Planter TD 內部開發團隊與遊戲設計者驗證和測試遊戲中的傷害計算公式。該工具將實現完整的傷害計算邏輯，包含基礎傷害、各種加成、護甲減免等複雜計算。

## 目標用戶

**主要用戶**：Planter TD 遊戲開發團隊

- 遊戲設計師：驗證數值平衡性
- 程式設計師：測試傷害計算邏輯
- 資料設計師：調整參數並觀察結果

**使用情境**：

- 新防禦塔或怪物數值設計時的驗證
- 平衡性調整的快速測試
- Bug 修復時的計算驗證

## 用戶故事與驗收標準

### US-1: 基礎傷害計算

**作為** 遊戲設計師  
**我希望** 輸入基礎攻擊參數並計算最終傷害  
**以便** 驗證傷害公式的正確性

**驗收標準**：

- **WHEN** 用戶輸入基礎傷害值
- **THEN** 系統應顯示未經任何修正的基礎傷害數值
- **AND** 計算結果應與手動計算一致

### US-2: 增傷與暴擊計算

**作為** 資料設計師  
**我希望** 設定各種傷害加成參數  
**以便** 測試不同加成組合的效果

**驗收標準**：

- **WHEN** 用戶輸入增加傷害百分比（如 30%）
- **THEN** 系統應按照公式 `基礎傷害 × (1 + Σ增加傷害)` 計算
- **WHEN** 用戶輸入暴擊傷害加成
- **THEN** 系統應計算 `(1 + (基礎暴擊傷害加成 + Σ暴擊傷害加成))`
- **AND** 支援多個加成項目的累加

### US-3: 護甲與穿甲計算

**作為** 遊戲設計師  
**我希望** 測試護甲減免與穿甲機制  
**以便** 平衡防禦與攻擊數值

**驗收標準**：

- **WHEN** 用戶輸入敵人護甲值
- **THEN** 系統應使用護甲公式計算減免率：`護甲 / (護甲 + 500)`
- **WHEN** 用戶輸入穿甲效果數值
- **THEN** 系統應計算有效穿甲率：`Σ穿甲效果 / (Σ穿甲效果 + 100)`
- **AND** 穿甲後護甲 = 護甲 × (1 - 有效穿甲率)
- **AND** 穿甲效果最多忽略 75% 護甲

### US-4: 傷害減免與承受傷害

**作為** 程式設計師  
**我希望** 驗證各種減免與增傷效果  
**以便** 確保程式實作正確

**驗收標準**：

- **WHEN** 用戶輸入傷害減免百分比
- **THEN** 系統應按照 `(1 - Σ傷害減免)` 計算
- **WHEN** 用戶輸入承受傷害加成
- **THEN** 系統應按照 `(1 + Σ承受傷害)` 計算
- **AND** 支援負數減免（即額外增傷）

### US-5: 完整公式驗證

**作為** 開發團隊成員  
**我希望** 查看完整的計算過程  
**以便** 理解每個步驟的計算邏輯

**驗收標準**：

- **WHEN** 用戶完成所有參數輸入
- **THEN** 系統應顯示最終傷害計算結果
- **AND** 應顯示每個計算步驟的中間結果
- **AND** 計算公式為：
  ```
  最終傷害 = 基礎傷害 × (1+Σ增加傷害) × (1+(基礎暴擊傷害加成+Σ暴擊傷害加成))
           × (1-護甲減免率) × (1-Σ傷害減免) × (1+Σ承受傷害)
  ```

### US-6: 計算範例對照

**作為** 遊戲設計師  
**我希望** 使用預設範例快速驗證  
**以便** 確認計算器的準確性

**驗收標準**：

- **WHEN** 用戶選擇預設範例（如文檔中的範例 1 和範例 2）
- **THEN** 系統應自動填入對應的參數值
- **AND** 計算結果應與文檔範例完全一致
- **AND** 範例 1 結果應為約 957.42
- **AND** 範例 2 結果應為約 1096.88

### US-7: 參數重置與清除

**作為** 用戶  
**我希望** 快速重置所有輸入參數  
**以便** 開始新的計算

**驗收標準**：

- **WHEN** 用戶點擊重置按鈕
- **THEN** 所有輸入欄位應回到預設狀態
- **AND** 計算結果應被清除
- **AND** 操作應有確認提示避免誤觸

## 功能需求

### 核心功能

1. **互動式輸入介面**：提供所有傷害計算參數的輸入欄位
2. **即時計算**：輸入變更時自動重新計算結果
3. **計算步驟顯示**：展示每個計算階段的中間結果
4. **預設範例**：提供文檔中的計算範例快速驗證
5. **參數驗證**：檢查輸入值的合理性與格式

### 資料驗證需求

- **數值範圍檢查**：
  - 基礎傷害 > 0
  - 護甲值 >= 0
  - 百分比加成合理範圍（如 -100% 到 +1000%）
- **輸入格式檢查**：僅接受數值輸入
- **錯誤提示**：清楚的錯誤訊息與輸入指引

### 使用者體驗需求

- **響應式設計**：支援桌面與平板裝置
- **直觀介面**：參數分組清晰，計算流程易懂
- **快速操作**：支援鍵盤快捷鍵與批次輸入

## 非功能需求

### 效能需求

- **計算響應時間** < 100ms
- **頁面載入時間** < 2 秒

### 相容性需求

- 支援現代瀏覽器（Chrome, Firefox, Safari, Edge）
- 整合到現有的 Nuxt 3 應用架構
- 與現有 shadcn/ui 設計系統一致

### 維護性需求

- 計算邏輯與 UI 分離
- 易於更新公式參數
- 支援未來新增計算類型

## 約束條件

### 技術約束

- 必須使用 Vue 3 Composition API
- 整合 shadcn/ui 元件庫
- 遵循專案的 TypeScript 規範

### 業務約束

- 計算邏輯必須與遊戲內實作完全一致
- 僅供內部團隊使用（目前階段）
- 資料不需要持久化儲存

## 驗收測試場景

### 測試場景 1：基本計算驗證

**輸入**：基礎傷害=1000, 增加傷害=30%, 暴擊加成=50%, 護甲=600, 無其他效果  
**期望輸出**：約 520 傷害

### 測試場景 2：複雜計算驗證

**輸入**：文檔範例 1 的所有參數  
**期望輸出**：957.42 傷害

### 測試場景 3：穿甲效果驗證

**輸入**：文檔範例 2 的所有參數（含穿甲 100%）  
**期望輸出**：1096.88 傷害

### 測試場景 4：邊界值測試

**輸入**：穿甲效果 = 300%（超過理論最大值）  
**期望行為**：正確處理上限邏輯，穿甲率不超過 75%

## 問題與假設

### 需要澄清的問題

1. **小數位精度**：計算結果要顯示到第幾位小數？
2. **參數上限**：各參數是否有合理的輸入上限？
3. **計算模式**：是否需要支援「反推計算」（給定最終傷害推算所需參數）？
4. **批次計算**：是否需要支援多組參數的批次計算與比較？

### 目前假設

- 計算結果顯示到小數點後 2 位
- 使用即時計算，不需要手動觸發
- 暫不支援計算結果的儲存與分享功能
- 優先實作單次計算，批次功能列為未來擴展
