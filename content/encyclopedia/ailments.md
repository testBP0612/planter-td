# [異常狀態] Ailments

Owner: 黃柏鈞
Created time: October 27, 2024 3:27 PM

# **傷害型異常狀態(Damaging Ailment)**

設計原則：

1. 傷害加成反比於狀態的疊加能力：
   - 流血最高（無法疊加）
   - 燃燒次之（有限疊加）
   - 中毒適中（無限疊加）
2. 持續時間設計：
   - 燃燒：高持續時間加成，增加疊加機會
   - 流血：適中持續時間加成，維持穩定輸出
   - 中毒：不需要持續時間加成，專注於疊層
3. 遊戲策略：
   - 燃燒：鼓勵多塔配合
   - 流血：適合單塔主輸出
   - 中毒：適合疊加戰術

### **燃燒(Burning)，**持續傷害

特點：多塔重疊時傷害可觀

- 基礎傷害為原傷害的**40%**。持續3秒。
  - 同一個燃燒傷害來源，由傷害最高者覆蓋，且刷新持續時間。
  - 可疊加複數傷害來源的燃燒效果。

### **流血(Bleed)**，**持續**傷害

特點：單體傷害最穩定持久

- 基礎傷害為原傷害的**100%**。持續6秒。
  - 流血傷害取最高者，持續時間不覆蓋。
  - 只能存在一種流血效果。

### **中毒(Poison)**，持續傷害

特點：堆疊層數多時傷害可觀

- 基礎傷害為原傷害的**20%**，持續2秒。
  - 複數中毒傷害可無限疊加，持續時間會刷新，每層效果遞減**10%**，最低**50%**。

# **非傷害型異常狀態(non-Damaging Ailment)**

## 設計核心概念

1. **基礎異常效果**

   每種異常狀態都先訂出一個「基礎效果值」及「基礎持續時間」，使其即便在最低傷害量的情況下依然能發揮最小程度的效果。
   - 例如：
     - 緩速(Slow)基礎減速 10%，基礎持續時間 2 秒
     - 暈眩(Stun)基礎暈眩 0.5 秒
     - 恐懼(Fear)基礎持續 0.5 秒，反向移動 50% 速度（或固定數量格）

2. **動態加成機制**

   將「實際造成的傷害量」與「目標血量」或「固定參考值」做比對，計算出一個「異常強度係數」。此係數會在「最低值」與「最高值」之間浮動，並套用到前述的「基礎效果值」或「基礎持續時間」上。
   - **異常強度係數**(X) = clamp( ( 實際傷害 / 比較基準 ) × K, 最小值, 最大值 )
     - `比較基準` 可為敵人的最大血量、當前血量或設定好的固定數值
     - `K` 為調整難易度的倍率
     - `clamp` 表示將係數限制在最小值與最大值之間

3. **最小/最大下限**

   為避免高血量敵人或低血量敵人讓異常狀態變得過於極端，設計一個最小與最大效果門檻。
   - 例如：
     - 最低減速 10%，最高減速 30%
     - 暈眩最少 0.2 秒，最多 1 秒

4. **效果與持續時間分離或合併**

   可以選擇只調整「異常強度」(如減速幅度)，基礎持續時間固定；或同時依傷害量調整「異常強度」與「持續時間」，讓異常施加端有更大空間去影響戰局。

## 緩速(Slow)

- **基礎持續時間**：2 秒
- **基礎減速效果**：10%
- **最大減速效果**：30%
- **比較基準**：敵人最大生命的 5%
- **K**：2（調整係數，用於平衡遊戲難度）

### 計算範例

1. **傷害量 = 20、敵人最大血量 = 300**
   - `比較基準` = 300 × 5% = 15
   - `實際傷害 / 比較基準` = 20 / 15 = 1.33
   - `異常強度係數` = 1.33 × 2 = 2.66
   - clamp(2.66, 1, 3) ≈ 2.66
   - 最後減速 ≈ 26%（持續 2 秒）
2. **傷害量 = 50、敵人最大血量 = 1000**
   - `比較基準` = 1000 × 5% = 50
   - `實際傷害 / 比較基準` = 50 / 50 = 1
   - `異常強度係數` = 1 × 2 = 2
   - clamp(2, 1, 3) = 2
   - 最後減速 = 20%（持續 2 秒）
3. **傷害量 = 120、敵人最大血量 = 300**
   - `比較基準` = 300 × 5% = 15
   - `實際傷害 / 比較基準` = 120 / 15 = 8
   - `異常強度係數` = 8 × 2 = 16
   - clamp(16, 1, 3) = 3 → 已達最大上限
   - 最後減速 = 30%（持續 2 秒）

## 冰凍(Freeze)

- **總持續時間**：2 秒 (固定)
  - **階段 1 (0~1 秒)**：行動速度被凍結到一定程度(介於 50% ~ 100%)
  - **階段 2 (1~2 秒)**：從階段 1 的凍結幅度，線性恢復至正常(0%)
- **最低凍結效果**：50% (敵人速度降至 50%)
- **最高凍結效果**：100% (完全靜止)
- **比較基準**：敵人最大生命的 5%
- **K**：0.12（調整係數；數值偏小，讓高傷害才有可能逼近 100% 凍結）

### 計算方式

1. 先計算一個「凍結係數」(FreezeFactor)：
   1. $FreezeFactor=\frac{\mathrm{傷害量}}{\mathrm{敵人最大血量}\times5\%}\times K$
2. 若 FreezeFactor < 1，則僅達到 **最低凍結** 50%；若 > 1，則根據超出比例逐步靠近 100%，但最多不超過 100%。

### 計算範例

1. **傷害量 = 10、敵人最大血量 = 400**
   - `比較基準` = 400 × 5% = 20
   - `實際傷害 / 比較基準` = 10 / 20 = 0.5
   - `FreezeFactor` = 0.5 × 0.12 = 0.06
   - 階段 1 (前 1 秒)：約 **(50% + 0.06×(100%-50%)) = 50% + 3% = 53%**
   - 階段 2 (後 1 秒)：由 53% 線性恢復到 0%
2. **傷害量 = 150、敵人最大血量 = 300**
   - `比較基準` = 300 × 5% = 15
   - `實際傷害 / 比較基準` = 150 / 15 = 10
   - `FreezeFactor` = 10 × 0.12 = 1.2 → 仍需 clamp 至 1(上限)
   - 階段 1：**100% 完全靜止**
   - 階段 2：1 秒內從 100% 緩慢恢復至 0%
3. **傷害量 = 5、敵人最大血量 = 500**
   - `比較基準` = 500 × 5% = 25
   - `實際傷害 / 比較基準` = 5 / 25 = 0.2
   - `FreezeFactor` = 0.2 × 0.12 = 0.024
   - 0.024 < 1 → 約 **(50% + 0.024×50%) = 51%** 凍結(無條件進位)
   - 階段 1：51% → 階段 2：1 秒內恢復

> 可見若傷害量相對低，就只能達到 50~60% 區間；要達到 100% 靜止需相對高的輸出。

---

## 暈眩(Stun)

- **最短暈眩時間**：0.5 秒
- **最長暈眩時間**：1.5 秒
- **比較基準**：敵人最大生命的 50% (高門檻，避免輕易獲得長時間暈眩)
- **K**：1.0 (維持線性，讓傷害量直接對應暈眩時間)

### 計算方式

$StunTime=clamp\left(\frac{\mathrm{傷害量}}{\mathrm{敵人最大血量}\times50\%},\;0.5,\;1.5\right)$

- 若計算結果 < 0.5 → 0.5 秒
- 若計算結果 > 1.5 → 1.5 秒

### 計算範例

1. **傷害量 = 10、敵人最大血量 = 400**
   - `比較基準` = 400 × 50% = 200
   - `實際傷害 / 比較基準` = 10 / 48 ≈ 0.05
   - 暈眩時間 = clamp(0.05, 0.5, 1.5) → 0.5 秒 (最低值)
2. **傷害量 = 150、敵人最大血量 = 300**
   - `比較基準` = 150 × 50% = 75
   - `實際傷害 / 比較基準` = 150 / 75 = 2
   - 暈眩時間 = clamp(2, 0.5, 1.5) = 2 秒 (最高值)

---

## 恐懼(Fear)

- **最短恐懼時間**：0.35 秒
- **最長恐懼時間**：1 秒
- **比較基準**：敵人最大生命的 38%
- **K**：1.0 (同樣維持線性關係)

### 計算方式

$FearTime=clamp\left(\frac{\mathrm{傷害量}}{\mathrm{敵人最大血量}\times38\%},\;0.5,\;1.5\right)$

- 若計算結果 < 0.35 → 0.35 秒
- 若計算結果 > 1.0 → 1.0 秒

### 計算範例

1. **傷害量 = 15、敵人最大血量 = 500**
   - `比較基準` = 500 × 38% = 190
   - `實際傷害 / 比較基準` = 15 / 190 ≈ 0.079
   - 恐懼時間 = clamp(0.079, 0.35, 1.0) → 0.35 秒
2. **傷害量 = 100、敵人最大血量 = 400**
   - `比較基準` = 400 × 38% = 152
   - `實際傷害 / 比較基準` = 100 / 152 ≈ 0.657
   - 恐懼時間 = clamp(0.657, 0.35, 1.0) → 約 0.657 秒
3. **傷害量 = 200、敵人最大血量 = 300**
   - `比較基準` = 300 × 38% = 114
   - `實際傷害 / 比較基準` = 200 / 114 ≈ 1.75
   - 恐懼時間 = clamp(1.75, 0.35, 1.0) = 1.0 秒 (達到上限)

## 束縛(Bind)

- **效果說明**：
  1. 施加後，敵人的移動速度立即降低至一定百分比(最小 30% ~ 最大 60%)
  2. 此效果持續「無限」，但會隨敵人行走距離逐漸衰減至 0%（最終完全恢復）
- **最小初始減速**：30%
- **最大初始減速**：60%
- **比較基準**：敵人最大生命的 **40%**
- **K**：1.0 (使用線性關係來決定初始減速幅度)

### 計算方式

定義一個「束縛係數」(BindFactor)來判斷「初始減速幅度」：

$BindFactor=\left(\frac{\mathrm{傷害量}}{\mathrm{敵人最大血量}\times40\%}\right)$

之後將 BindFactor clamp 到 [0, 1]，並依此線性插值最小 30% 與最大 60%。

- 若 BindFactor < 0 → 視作 0
- 若 0 ≤ BindFactor ≤ 1 → 30% + (60% - 30%) × BindFactor
- 若 BindFactor > 1 → 60%

### 計算範例

1. **傷害量 = 50、敵人最大血量 = 400**
   - `比較基準` = 400 × 40% = 160
   - `實際傷害 / 比較基準` = 50 / 160 = 0.3125
   - `BindFactor` = 0.3125 × 1.0 = 0.3125
   - clamp(0.3125, 0, 1) = 0.3125
   - 初始減速 = 30% + (60% - 30%) × 0.3125 = 30% + 9.375% ≈ 39.375%
2. **傷害量 = 20、敵人最大血量 = 300**
   - `比較基準` = 300 × 40% = 120
   - `實際傷害 / 比較基準` = 20 / 120 ≈ 0.167
   - `BindFactor` = 0.167 × 1.0 = 0.167
   - clamp(0.167, 0, 1) = 0.167
   - 初始減速 ≈ 30% + (60% - 30%) × 0.167 = 30% + 5% = 35%
3. **傷害量 = 120、敵人最大血量 = 200**
   - `比較基準` = 200 × 40% = 80
   - `實際傷害 / 比較基準` = 120 / 80 = 1.5
   - `BindFactor` = 1.5 × 1.0 = 1.5 → clamp(1.5, 0, 1) = 1
   - 初始減速 = 60% (達到上限)

> 在初始減速後，敵人每走一段距離時，效果會逐漸衰減至 0%。可自訂「衰減速度」或「衰減距離」，以免過度拉長控制效果。

## 破甲(Cracks Armor)

- **效果說明**：
  1. 敵人受到的傷害增加一定百分比(最小 +20% ~ 最大 +35%)
  2. 持續時間建議固定，如 5 秒；期間內可被刷新，但不疊加(若新效果更強則覆蓋)
- **最小增傷**：+20%
- **最大增傷**：+35%
- **持續時間**：5 秒 (可依平衡做調整)
- **比較基準**：敵人最大生命的 **40%**
- **K**：1.0 (線性關係，傷害越大，越靠近 35% 上限)

### 計算方式

定義「破甲係數」(CracksFactor)：

$BindFactor=\left(\frac{\mathrm{傷害量}}{\mathrm{敵人最大血量}\times40\%}\right)$

將 CracksFactor clamp 到 [0, 1]，並線性插值最小 +20% 與最大 +35%。

- 0 ≤ CracksFactor ≤ 1 → +20% + (35% - 20%) × CracksFactor
- 超過 1 → +35%

### 計算範例

1. **傷害量 = 50、敵人最大血量 = 500**
   - `比較基準` = 500 × 40% = 200
   - `實際傷害 / 比較基準` = 50 / 200 = 0.25
   - `CracksFactor` = 0.25 × 1.0 = 0.25
   - clamp(0.25, 0, 1) = 0.25
   - 增傷 = +20% + (35% - 20%) × 0.25 = 20% + 3.75% = +23.75%
   - 持續 5 秒
2. **傷害量 = 30、敵人最大血量 = 300**
   - `比較基準` = 300 × 40% = 120
   - `實際傷害 / 比較基準` = 30 / 120 = 0.25
   - `CracksFactor` = 0.25 → +20% + (35%-20%)×0.25 = +23.75%
   - 持續 5 秒
3. **傷害量 = 150、敵人最大血量 = 300**
   - `比較基準` = 300 × 40% = 120
   - `實際傷害 / 比較基準` = 150 / 120 ≈ 1.25
   - clamp(1.25, 0, 1) = 1 → 達上限
   - 增傷 = +35% (最大值)
   - 持續 5 秒

> 要讓破甲達到最高 35% 的增傷，需要攻擊傷害高於「敵人最大血量的 40%」。這樣能避免小額傷害也一直施加最強破甲。

### **傷口(Wound)**

- 持續時間無限，再次受到傷害轉換為流血。
